---
title: "Analysis of MK2 transcript levels in TCGA-LUAD (NSCLC) dataset"
author: "Karthik Suresh"
date: "May 15, 2019"
output:
  html_document:
    theme: united
    toc: yes
  pdf_document:
    toc: yes
---
Here, we are downloading clinical data from TCGA-LUAD dataset using the TCGAbiolinks API. For the MK2 transcript data, I grabbed these data from oncoLnc.org using "MAPKAPK2" as the gene name and TCGA-LUAD as the cohort. 

# Data retrieval and cleaning

## Retrieve data from TCGA dataset, _join it with the MK2 transcript data

We retrieve the clinical data directly using GDC_query. For the MK2 transcript data, this was downloaded from OncoLnc.org using the following parameters: Gene-MAPKAPK2, and percentile: 50/50. We did this because this allowed us to get transcript levels on all available patients (since upper and lower 50% would include all patients). We then calculated the quantiles manually, so that in the future, if we needed to change the threshold, we could do so without re-downloading the OncoLnc data. 

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
library("SummarizedExperiment")
library("dplyr")
library("DT")
library("TCGAbiolinks")
library(survival)
library(ggplot2)
library(ggpubr)
library(survminer)
library(knitr)
library("tidyr")
library("ggpmisc")

clinical <- GDCquery_clinic(project = "TCGA-LUAD", type = "clinical")
expr <- read.csv("../rawdata/LUAD.MAPKAPK2Exp.csv")
Casp3exp <- read.csv("../rawdata/LUAD.casp3Exp.2.csv")
colnames(expr) <- c("Patient", "MK2.Expression")
colnames(Casp3exp) <- c("Patient", "Casp3.Expression")
# the left_join. we need the clinical data, so we left_joined by TCGA patient id to the clinical dataset. This means that if there was a patient with clinical data without transcript levels, that would be a 'NA'. 
clinical <- left_join(clinical, expr, c("submitter_id"= "Patient"))
clinical <- left_join(clinical, Casp3exp, c("submitter_id"="Patient"))
# let's do some checking to make sure the left_join happened properly, since this is a critical step. 

# So, here, what we have done is to collect the pt. id and MK2 expression data from 2 datasets: the joined clinical data frame, which contains the Expr data and the clinical data, and the MK2 Expression data set, which was downloaded from OncoLnc.org and only contains the downloaded Expr data. Next for each clinical pt, we asked if the Expression value in the joined data matches the Expression value from the other dataset. 

JoinCheck_clin <<- cbind(clinical$submitter_id, clinical$MK2.Expression)
JoinCheck_oncolnc <<- cbind(as.character(expr$Patient), expr$MK2.Expression)

colnames(JoinCheck_clin) <- c("clin.id", "clin.val")

colnames(JoinCheck_oncolnc) <- c("oncolnc.id", "oncolnc.val")

JoinCheck_clin<-as.data.frame(JoinCheck_clin)
JoinCheck_oncolnc<-as.data.frame(JoinCheck_oncolnc)

CheckValue <- function(clin.id, clin.val) {
   if(!is.na(clin.val)){
      
      if(JoinCheck_oncolnc[JoinCheck_oncolnc$oncolnc.id==clin.id,]$oncolnc.val==clin.val) return(1)
      else return(0)
   }
}

JoinCheck_clin$checkVal <- mapply(CheckValue, as.character(JoinCheck_clin$clin.id), JoinCheck_clin$clin.val)

# the checkVal value should be either 1 (the joined Expression value and the downloaded Expression value match) or NULL (clinical data is present, but there is no expression value found in the oncolnc data).
table(as.character(JoinCheck_clin$checkVal))


```

## Clean the data, create a df for an LR and Cox PH analyses later

Now that we have left-joined the data, and checked to make sure that the join was done properly, we move on to prep the data for Cox PH work. 
```{r include=TRUE}


clinical$time <- mapply(function(x,y) if(is.na(x)) return(y) else return(x), clinical$days_to_death, clinical$days_to_last_follow_up) 
clinical$age_at_diagnosis <- clinical$age_at_diagnosis/365
clinical$race <- as.factor(clinical$race)
clinical$smoking <- lapply(clinical$cigarettes_per_day, function(x) if(!is.na(x)) return(1) else return(0))
clinical$tumor_stage <- as.factor(clinical$tumor_stage)
clinical$vital_status <- as.factor(clinical$vital_status)
clinical$status <- lapply(clinical$vital_status, function(x) if(x=="alive") return(0) else return(1))
clinical$smoking <- as.numeric(clinical$smoking)


# combine clinical stage

combineStage <- function(x) {
if(!is.na(x))  {
if(x=="Stage I" | x=="Stage IB" | x=="Stage IA") return("Early Stage")
if(x=="Stage II" | x=="Stage IIA" | x=="Stage IIB") return("Early Stage")
if(x=="Stage IIIA" | x=="Stage IIIB") return("Late Stage")
if(x=="Stage IV") return("Late Stage")
}
  } 

# combined histologic types 

combinePath <- function(x) {
 if(!is.na(x))  {
   
   if(x=="Adenocarcinoma, NOS") return("Adenocarcinoma")
   if(x=="Mucinous adenocarcinoma")  return("Adenocarcinoma")
   if(x=="Adenocarcinoma with mixed subtypes") return("Adenocarcinoma")
   if(x=="Papillary adenocarcinoma") return("Adenocarcinoma")
   else return("Non-Adenocarcinoma")
   
 }
  
}

# combine sub-stages into 1,2,3
clinical$ajcc_pathologic_stage_combined <- lapply(clinical$ajcc_pathologic_stage, combineStage)

clinical$ajcc_pathologic_stage_combined <- as.factor(as.character(clinical$ajcc_pathologic_stage_combined))

# combine histology types
clinical$primary_diagnosis_combined <- lapply(clinical$primary_diagnosis, combinePath)
clinical$primary_diagnosis_combined<- as.factor(unlist(clinical$primary_diagnosis_combined))

# get rid of NULL entries
clinical <- clinical[clinical$ajcc_pathologic_stage_combined!="NULL",]


# We already got rid of NULLs for ajcc_pathologic_stage. However, the factor levels still list 3 levels - early, late and NULL. To re-level, convert to character, re-convert to factor, and now only 2 levels. 
clinical$ajcc_pathologic_stage_combined<-as.factor(as.character(clinical$ajcc_pathologic_stage_combined))

clinical <- clinical[!is.na(clinical$MK2.Expression), ]

# create censor variable for CoxPH
clinical$censor <- lapply(clinical$vital_status, function(x) if(x=="Alive") return(0) else return(1))
clinical$censor <- as.numeric(clinical$censor)

# scale the MK2 variable
clinical$MK2.Expression <- clinical$MK2.Expression/1000
clinical$Casp3.Expression <- clinical$Casp3.Expression/1000
# create a simplified stage

combineStage.Simp <- function(x) {
if(!is.na(x))  {
if(x=="Stage I" | x=="Stage IB" | x=="Stage IA") return("Stage 1")
if(x=="Stage II" | x=="Stage IIA" | x=="Stage IIB") return("Stage 2")
if(x=="Stage IIIA" | x=="Stage IIIB") return("Stage 3")
if(x=="Stage IV") return("Stage 4")
}
  } 
clinical$ajcc_pathologic_stage_combined.2 <- lapply(clinical$ajcc_pathologic_stage, combineStage.Simp)
clinical$ajcc_pathologic_stage_combined.2 <- as.factor(unlist(clinical$ajcc_pathologic_stage_combined.2))
```


# Exploratory graphs

## Plot differences in transcript level by tumor histology and cancer stage

```{r}
# plot MK2 differences for adenocarcinoma only
ggplot(clinical[clinical$primary_diagnosis_combined=="Adenocarcinoma", ], aes(x=ajcc_pathologic_stage_combined, y=MK2.Expression, ))+geom_boxplot()+geom_point(position=position_jitter())+stat_compare_means()+theme_bw()+ylab("MK2 transcript level")
```
This is a key difference: MK2 is clearly associated with tumor stage. Early stage tumors have more MK2 transcript than late stage tumors. Thus, going forward, we will stratify our analyses by Tumor stage. 

```{r}
ggplot(clinical[clinical$primary_diagnosis_combined=="Adenocarcinoma", ], aes(x=ajcc_pathologic_stage_combined.2, y=MK2.Expression, ))+geom_boxplot()+geom_point(position=position_jitter())+stat_compare_means()+theme_bw()+ylab("MK2 transcript level")

ggplot(clinical, aes(x=ajcc_pathologic_stage_combined, y=MK2.Expression, fill=primary_diagnosis_combined))+geom_boxplot()+geom_point(position=position_jitterdodge())+theme_bw()


```

## Explore the relationship between MK2 and Casp3
```{r}

ggplot(clinical, aes(x=MK2.Expression,y=Casp3.Expression)) + geom_point()

```
## Defining MK2 thresholds for "high" and "low" - Top 1/3 vs Bottom 2/3

Mechanistically, we're more interested in whether high vs. low MK2 transcript levels impact outcome. For this, we first categorize MK2 transcript levels based on quantiles and only take the lower and upper third in our groups for comparison. 
```{r}

# classify the MK2 expression variable as either top or bottom quantile, based on quantile definitions

bottom_quant <<- 0.33
top_quant <<- 0.66

clinical$MK2_Expression_bottomQ <- lapply(clinical$MK2.Expression, function (x) if(x < quantile(clinical$MK2.Expression, bottom_quant))  return(1) else return(0))

clinical$MK2_Expression_topQ <- lapply(clinical$MK2.Expression, function (x) if(x > quantile(clinical$MK2.Expression, top_quant))  return(1) else return(0))

```



## Changes in proportion of people who died across quantiles of MK2

### Prep data for using MK2 quantiles

```{r}
# quantile and logistic regression

# this is the new data frame for this new round of calculations. 

MK2_CoxPH_quantile <- clinical
# the scaling here is to help the point estimates for the LR and Cox PH models be more reasonable. 

# this provides the variable for R censoring at one year and the outcome variable for logit regression.
MK2_CoxPH_quantile$death_at_1year <- mapply(function(dead,time) if(dead==1 & time <366) return(1) else if(dead==0 & time > 366) return(0) else if (dead==0 & time < 366) return(0) else if (dead==1 & time > 366) return(0), MK2_CoxPH_quantile$censor, as.numeric(MK2_CoxPH_quantile$time))

MK2_CoxPH_quantile$death_at_2year <- mapply(function(dead,time) if(dead==1 & time <366*2) return(1) else if(dead==0 & time > 366*2) return(0) else if (dead==0 & time < 366*2) return(0) else if (dead==1 & time > 366*2) return(0), MK2_CoxPH_quantile$censor, as.numeric(MK2_CoxPH_quantile$time))

MK2_CoxPH_quantile$death_at_3year <- mapply(function(dead,time) if(dead==1 & time <366*3) return(1) else if(dead==0 & time > 366*3) return(0) else if (dead==0 & time < 366*3) return(0) else if (dead==1 & time > 366*3) return(0), MK2_CoxPH_quantile$censor, as.numeric(MK2_CoxPH_quantile$time))

# this piece of code above is critical - so let's double check and make sure everything got done right

ggplot(MK2_CoxPH_quantile, aes(x=submitter_id, y=time, color=as.factor(vital_status)))+ geom_point()+facet_wrap(~as.factor(death_at_1year))+ylim(0,500)+xlab("Patient ID") + ylab("time to death")+geom_hline(yintercept = 365)
```

Interpretation off the plot above. So, we have colored each patient’s vital status by alive or dead, and we have faceted by whether they were assigned as “Death in one year” or not. So, if our code worked, all patients who died in less than one year (blue color; y < 365) should be classified as dead at one year (“1”). All patients who were alive in that time period should be classified as red and in the “0” column. After 365 days, everyone should have gotten a classification of “0” for death at one year, since they are all by definition still alive at 1 year, regardless of subsequent alive or dead status (color should mix, all colors in the “0” column). And that’s what we see…

### Proportion of deaths by MK2 quantiles

```{r}
#Now, moving on.

MK2_CoxPH_quantile$MK2_quantile <- ntile(MK2_CoxPH_quantile$MK2.Expression, 5)
MK2_CoxPH_quantile$Casp3_quantile  <- ntile(MK2_CoxPH_quantile$Casp3.Expression, 5)
a <- aggregate(death_at_1year~MK2_quantile+ajcc_pathologic_stage_combined, FUN=sum, data=MK2_CoxPH_quantile)
b <- aggregate(death_at_1year~MK2_quantile+ajcc_pathologic_stage_combined, FUN=length, data=MK2_CoxPH_quantile)

quantile_df<-  as.data.frame(a$MK2_quantile)
quantile_df$stage <- as.data.frame(a$ajcc_pathologic_stage_combined)
quantile_df$prop <- as.data.frame(unlist(a$death_at_1year/b$death_at_1year))
quantile_df$prop <- unlist(quantile_df$prop)
colnames(quantile_df) <- c("quantile", "stage", "prop")
p1 <- ggplot(quantile_df[quantile_df$stage=="Early Stage",], aes(x=quantile, y=prop))+geom_point()+geom_smooth(method="lm", se=FALSE)+stat_poly_eq(formula="y~x", aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), parse = TRUE)+theme_bw()+ylim(0,1)

p2 <- ggplot(quantile_df[quantile_df$stage=="Late Stage",], aes(x=quantile, y=prop))+geom_point()+geom_smooth(method="lm", se=FALSE)+stat_poly_eq(formula="y~x", aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")), parse = TRUE)+theme_bw()+ylim(0,1)

# This graph shows the relationship between MK2 quantile  and proportion of patients  who died in Early and Late Stage cancers. The relationship between MK2 quantile and Proportion of those patients  who died (denominator: all patients  in that quantile) 
gridExtra::grid.arrange(p1,p2, ncol=2)

```

# Logistic regression modeling death at 1 year ~ MK2+covariates

## Data clean-up
```{r}
MK2_CoxPH_quantile$death_at_1year <- as.factor(MK2_CoxPH_quantile$death_at_1year)
# logistic regression and ROC
MK2_CoxPH_quantile$ajcc_pathologic_stage_early_stage <- unlist(MK2_CoxPH_quantile$ajcc_pathologic_stage_early_stage)
MK2_CoxPH_quantile$MK2_quantile <- as.factor(MK2_CoxPH_quantile$MK2_quantile)
MK2_CoxPH_quantile$MK2_Expression_topQ <- as.factor(unlist(MK2_CoxPH_quantile$MK2_Expression_topQ))
```

## Logistic regression for death at 1 year, stratified by early/late

### Univariate regression

```{r}
# LR stratified by Early/Late
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage", ], family=binomial(link="logit")))
```

In this univariate regression, there is a suggestion of a negative association between MK2 (treated as a continuous variable) and death at one year, in the early stage patients. That is, higher MK2 = lower odds of death at one year. the CIs are imprecise, and thus the p values is 0.06. We do not see this in the late-stage patients. 


### Multivariate regression 

```{r}
summary(glm(death_at_1year ~ MK2.Expression+smoking+age_at_diagnosis+gender, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage", ], family=binomial(link="logit")))

summary(glm(death_at_1year ~ MK2.Expression+smoking+age_at_diagnosis+gender, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage", ], family=binomial(link="logit")))
```

Even with adjustment, there is again a suggestion of a negative association between MK2 transcript level and death at one year, with a p value of 0.11. There is a strong positive association between male gender and death at one year. 


## Model 3: Logistic regression for death at 1 year, stratified by early/late, but using Top 1/3 MK2 expression (dichotomous MK2 variable)

We are interested in using MK2 as as dichotomous variable - high (top 1/3) or low (bottom 2/3). Clinically, with an appropriate reference cohort, this might be more translatable. Thus, we modeled death at one year, as a logistic regression, but now with MK2 as a dichotomous variable. The univariate analysis was significant, so here we run the multi-variate regression.

### Model 3: MK2 only

```{r}
logreg_topq1_early <- glm(death_at_1year ~ MK2_Expression_topQ+smoking+age_at_diagnosis+gender, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage", ], family=binomial(link="logit"))

summary(logreg_topq1_early)
exp(logreg_topq1_early$coefficients)
confint.lm(logreg_topq1_early)
```


```{r}
logreg_topq1_late <- glm(death_at_1year ~ MK2_Expression_topQ+smoking+age_at_diagnosis+gender, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage", ], family=binomial(link="logit"))

summary(logreg_topq1_late)

exp(logreg_topq1_early$coefficients)
confint.lm(logreg_topq1_early)
```

### Model 3: MK2 multivariate model with Casp3
Now we run the multi-variate model again but with casp3 expression
```{r}

summary(glm(death_at_1year ~ MK2_Expression_topQ+smoking+age_at_diagnosis+gender+Casp3.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage", ], family=binomial(link="logit")))

```
# Cox Proportional Hazards modeling, with right censoring at 1 year. 

## Data Cleaning

```{r}
# data cleaning prior to Cox PH model
MK2_CoxPH_quantile$MK2_Expression_topQ <- as.factor(unlist(MK2_CoxPH_quantile$MK2_Expression_topQ))
MK2_CoxPH_quantile$gender <- as.factor(MK2_CoxPH_quantile$gender)

# be careful here. as.numeric alone will return the factor level, not the value!
MK2_CoxPH_quantile$censor <- as.numeric(as.character(MK2_CoxPH_quantile$death_at_1year))
MK2_CoxPH_quantile$censor.2y <- as.numeric(as.character(MK2_CoxPH_quantile$death_at_2year))
MK2_CoxPH_quantile$censor.3y <- as.numeric(as.character(MK2_CoxPH_quantile$death_at_3year))

# there should be no discrepancy - only two dots should show up
plot(MK2_CoxPH_quantile$censor, MK2_CoxPH_quantile$death_at_1year)
```

## Model 1: Cox PH model R censored at one year, stratified by early/late, MK2 as a continuous variable

### Model 1: MK2 only
```{r}
# univariate Cox PH
summary(coxph(Surv(time, censor) ~ MK2.Expression, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",]))

# Multi-variate Cox PH 
MK2_coxph_model_tb_1y_early <- coxph(Surv(time, censor) ~ MK2.Expression+gender+smoking+age_at_diagnosis, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",])

MK2_coxph_model_tb_1y_late <- coxph(Surv(time, censor) ~ MK2.Expression+gender+smoking+age_at_diagnosis, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage",])


# PH testing
cox.zph(MK2_coxph_model_tb_1y_early)
cox.zph(MK2_coxph_model_tb_1y_late)

# results
summary(MK2_coxph_model_tb_1y_early)
summary(MK2_coxph_model_tb_1y_late)
```

So here, we can see that in multi-variate Cox PH model, we see a signal for MK2 and improved survival, but only in the early stage tumors. 


### Model 1: MK2 with casp 3

```{r}
summary(coxph(Surv(time, censor) ~ MK2.Expression+gender+smoking+age_at_diagnosis+Casp3.Expression, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",]))

```
## Model 2: Cox PH model R censored at one year, stratified by early late, MK2 as dichotomous (top 1/3 vs. bottom 2/3)

### Model 2: MK2 only
```{r}

summary(coxph(Surv(time, censor) ~ MK2_Expression_topQ+gender+smoking+age_at_diagnosis, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",]))

summary(coxph(Surv(time, censor) ~ MK2_Expression_topQ+gender+smoking+age_at_diagnosis, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage",]))


```

### Model 2: MK2 + casp3
```{r}
summary(coxph(Surv(time, censor) ~ MK2_Expression_topQ+gender+smoking+age_at_diagnosis+Casp3.Expression, id=submitter_id, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",]))
```

# Model Graphics
## Simulated HRs (model 1)

```{r}
library(simPH)
plotHR(MK2_coxph_model_tb_1y_early, term="MK2.Expression",rug="ticks",xlim=c(2,6)) 
plotHR(MK2_coxph_model_tb_1y_late, term="MK2.Expression",rug="ticks",xlim=c(2,6)) 
```
## KM curve - here, we're going to stratify MK2 by "hi" vs. "low" - Model 2

```{r}
library(survminer)
library(survival)
library(ggsci)
km_early <- survfit(Surv(time, censor)~MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Early Stage",], type='kaplan-meier')
ggsurvplot(km_early, xlim=c(0,365), conf.int = TRUE, break.x.by=100, pval=TRUE,ylim=c(0.5,1), palette = "lancet")

km_late <- survfit(Surv(time, censor)~MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined=="Late Stage",], type='kaplan-meier')
ggsurvplot(km_late, xlim=c(0,365), conf.int = TRUE, break.x.by=100, pval=TRUE)

```

## Predicted probabilities graphs for Logistic Regression (Model 3)
```{r}
library(effects)
MK2efx_early <- Effect("MK2_Expression_topQ", logreg_topq1_early)
MK2efx_late <- Effect("MK2_Expression_topQ", logreg_topq1_late)

MK2efx_early
MK2efx_late

p1 <- plot(MK2efx_late)
p2 <- p1 + plot(MK2efx_early)
```
# Demographics / Table 1 
```{r}

library(tableone)
listVars <- c("age_at_diagnosis", "gender", "smoking", "ajcc_pathologic_stage","ajcc_pathologic_n", "prior_malignancy", "primary_diagnosis", "time", "race", "MK2.Expression")
catVars <- c("gender", "smoking", "ajcc_pathologic_stage", "ajcc_pathologic_n", "prior_malignancy", "primary_diagnosis", "race") 

table1 <- CreateTableOne(listVars, clinical, catVars, strata=c("ajcc_pathologic_stage_combined"))
table1
```


# Additional attempted models

## Continuous MK2 expression, no R censoring:  Survival ~ expression (continuous) + clinical stage (stage 1, stage 2,...)

In this model, we use MK2 expression as a continuous variable - in other words, don't split into low vs. high (for that, see below). The 'MK.Expression' variable is the MK2 transcript level. Here, we're going to use the full follow-up time without any R censoring.

```{r}


# COX PH model
coxph_model_all <- coxph(Surv(time, censor) ~ MK2.Expression, id=submitter_id, data=clinical[clinical$ajcc_pathologic_stage_combined.2=="Stage 1",])


# examine MK2 expression values 
hist(clinical$MK2.Expression)

plot(cox.zph(coxph_model_all))
ggcoxdiagnostics(coxph_model_all)


```
These diagnostic plots aren't promising, and there we are really interested in early survival. Biologically, it makes more sense to focus on 1 year survival since 2- and 3- year survival may be related  to a lot of other factors (including chemo regimens recieved, etc)


## Logistic regression for death at 1 year, stratified by specific stage

As shown above, LR using MK2 as a continuous variable but tumor stage dichotomized as early/late produced some interesting results. We wondered if we were "overlumping" stage by combining Stage I and II into "Early Stage". Here we split stages into 1-4. Of course, now the problem was low numbers. These models did not yield any additional information, so were not considered further. 

```{r}
# LR stratified by individual stage
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 1", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 2", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 3", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2.Expression, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 4", ], family=binomial(link="logit")))

summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 1", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 2", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 3", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 4", ], family=binomial(link="logit")))

summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 1", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 2", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 3", ], family=binomial(link="logit")))
summary(glm(death_at_1year ~ MK2_Expression_topQ, data=MK2_CoxPH_quantile[MK2_CoxPH_quantile$ajcc_pathologic_stage_combined.2=="Stage 4", ], family=binomial(link="logit")))
```
